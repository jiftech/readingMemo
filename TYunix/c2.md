# Unix独習への近道 第2章
[全体目次へ戻る](index.md)

## 2章 ディレクトリとファイルの構造と操作
### 作成・複製・削除・移動
- `cd`:  作業ディレクトリの移動
  + 引数を指定しなければホームディレクトリに移動する
- `mkdir`: ディレクトリ作成
  + `-p`をつけると、必要なディレクトリを全て作成する
- `pwd`: 作業ディレクトリの確認

- globing: 名前が一定のパターンに合致するファイルを一気に選択できる機能

| glob文字 | 概要                            |
|:-------- |:------------------------------- |
| `*`      | 任意の0文字以上の文字列         |
| `?`      | 任意の1文字                     |
| `[...]`  | 括弧内のどれか1文字             |
| `[!...]` | 括弧内のどれとも一致しない1文字 |

- brace expansion
  + 共通部分を持つ複数の文字列を一気に作成するのに便利
  + エスケープ文字は`\`

```sh
$ echo *.{htm{l,},jp{e,}g}
*.html *.htm *.jpeg *.jpg

$ echo {a..d}
a b c d
```

- `touch`: 存在しないファイル名を指定することで、空ファイルを作ることができる
  + 本来は、ファイルの中身を変更せずに更新日時だけを変更するコマンド

- `rm`: ファイルを削除する
  + デフォルトではディレクトリを削除しない。globingなどで、ディレクトリとファイルを同時に指定した場合、ファイルのみが削除される
  + `-r`をつけると、指定したディレクトリ以下の全てのファイル・ディレクトリを再帰的に削除する
  + `-i`をつけると、1ファイルずつ削除するかどうか確認が入る
- `rmdir`: 空のディレクトリを削除する

- `cp`: ファイルをコピーする
  + `-r`をつけると、指定したディレクトリ以下の全てのファイル・ディレクトリを再帰的にコピーする
  + コピー先として複数のパスを指定することはできない

```sh
# d1ディレクトリ内の全ファイルをd2ディレクトリ以下にコピー
$ cp d1/* d2
```

- `mv`: ファイルを別のディレクトリへ移動する・ファイル名を変更する
  + 移動対象がディレクトリなら、その下の全てのファイル・ディレクトリも移動する
  + 移動先がディレクトリなら、そのディレクトリ以下に移動。ファイルなら、名前の変更となる
  + 移動元・移動先に複数のファイルを指定することはできない
    * 複数のファイル名を一括で変更するには、`for`を使って繰り返す
  + ファイルシステムを跨いだ移動は参照の書き換えだけでは実現できない
    * 移動元を構造・属性を保ったままコピーしてから削除することで、「移動」を実現する


```sh
# 拡張子が.dmgの全てのファイルの拡張子を.isoに変更
# %.*は「ピリオド以降の文字列を削除」の意味
for f in *.dmg; do mv ${f} ${f%.*}.iso; done
```

- ファイルはファイル実体(i-node + データ)への参照にすぎない。ハードリンクを作っても実体が増えたりコピーされることはない
- `ln [to] [from]`: ファイル`to`へのハードリンクを`from`のパスに作る
- `ln -s [to] [from]`: ファイル`to`へのシンボリックリンクを`from`のパスに作る
  + シンボリックリンクは、ファイルへの道筋を示したもので、リンク先が削除されるとデッドリンクとなる

- シェルの入力元・出力先を変更することを「リダイレクト」という
  + `> [file]`: 出力を`file`に上書き
  + `>> [file]`: 出力を`file`に追記
  + `< [file]`: `file`から入力
- ファイルの中身を消去するには、`/dev/null/`を`cp`したり`cat`してリダイレクトしたりする

### ディスク管理
- `du`: ディレクトリ下の各ファイルのサイズ(ディスク占有量)を表示する
  + `-s`をつけると指定したディレクトリの合計サイズを集計する
  + `-k`,`-m`でサイズの単位をKBまたはMBに変更できる
  + ディレクトリ以下の全ファイルをスキャンするので非常に時間がかかる!

- `df`: ファイルシステムの一覧を表示
  + `-i`をつけるとi-nodeの状態を確認できる
  + `-k`,`-m`でサイズの単位を変更できる

- `mount`: 現在マウントされているデバイスを確認したり、新たにファイルシステムをマウントする
  + マウントする場合の書式: `mount -t [file-system type] [device] [position]`

- `find`: ファイルの検索・操作
  + 基本書式: `find [検索対象ディレクトリ] [オプション...]`
  + `-name`オプション: 指定パターンに一致するファイルのみ検索
  + `-exec`オプション: 検索したファイルを引数にコマンドを実行
  + `-type`オプション: 特定の種類のファイルのみ検索
  + `-printf`オプション: 出力の書式を指定

```sh
# カレントディレクトリ以下の、拡張子が.docのファイルを全て削除
# -exec以下の"{}"の場所に検索結果のファイルが入る
# "\;"は単なるエスケープ
$ find . -name '*.doc' -exec rm {} \;
```


#### ファイルの圧縮
- 圧縮ツールとしてよく使われるのは`gzip`,`bzip2`
  + `gzip`の方が高速だが、圧縮率は`bzip2`の方が上
- `zless`,`zcat`,`zgrep`のような、ファイルを圧縮されたまま扱えるコマンドも用意されている

- `tar`: ディレクトリ以下のファイルをまとめる(アーカイブする)。オプションは以下の通り
  + `c`: アーカイブ作成
  + `v`: 詳細メッセージ
  + `f`: ターゲットパスを指定
  + `t`: アーカイブの内容確認
  + `x`: 内容を取り出す
  + `z`/`j`: `gzip`/`bzip2`形式で圧縮しつつアーカイブする
  + `-C`: カレントディレクトリを変更

```sh
# カレントディレクトリ以下をmytar.tarにアーカイブ
$ tar cvf mytar.tar .

# mytar.tarの内容をカレントディレクトリ以下に展開
$ tar xvf mytar.tar

# カレントディレクトリ以下を圧縮しつつmytar.tar.gzにアーカイブ
$ tar cvzf mytar.tar.gz .

# mytar.tar.gzを解凍しつつ展開
$ tar xvzf mytar.tar.gz
```

***

[前へ](c1.md) /
[全体目次へ戻る](index.md) /
[次へ](c3.md)
