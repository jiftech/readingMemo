# Unix独習への近道 第4章
[全体目次へ戻る](index.md)

## 4章 ツール開発や自動化に応用できる文字列操作のノウハウ
### 簡単なテキスト処理(表示・並べ替え・結合・切り出し)
- `head`/`tail`: 入力の先頭/末尾を指定行数だけ出力する
  + `-n [num]`で行数を指定(デフォルトは10)
  + `head`の場合、行数に`-`をつけると末尾n行を削除する
  + `tail`の場合、行数に`+`をつけるとn行目以降を出力する

- `sort`: ソートする
  + デフォルトでは辞書順ソートになる。数値としてソートするには`-n`をつける(このとき、数値以外は先頭に来る)

```sh
# ヘッダ行が含まれている場合にヘッダ以外をソートするパターン
$ head -n +1 file; tail -n +2 file | sort

# エラーを考慮し、出力先をファイルにしたバージョン
$ (head -n +1 file && tail -n +2 file | sort) > file2
```

- `uniq`: 連続した重複行を取り除く

- `cat`: 複数のファイルを指定することで、ファイルの結合を行う
- `paste`: ファイルを横に結合する(`cat`は縦)

- `cut`: データからカラムを切り出す
  + `-f[カラム番号]`で切り出すカラムを指定する。カラム番号は左から・1始まり。コンマ区切りで複数指定できる
  + `-d`: 指定した文字を区切り文字にする。デフォルトではタブ
- `join`: 同じキーを持つ行を結合する
  + 各行はキーでソートされている必要がある

- `<(list)`という書法で`list`の内容を外側のコマンドの入力として扱うことができる
  + `list`はコマンドでもよく、その実行結果が入力となる。一時ファイルを作成しないので効率的

```sh
# 「f1から重複を除いたもの」とf2をキーで結合
$ join <(uniq f1) f2
```

- `comm`: 2つのファイルの各行を比較し、1番目のファイルのみ・2番めのファイルのみ・共通の行の3つに分類
  + 各行はソートされている必要がある

- `wc`: ファイルに含まれる行・単語・文字数を数える
- `nl`: 行番号をつけて表示する

- `rev`: 行ごとに文字を逆順に並び替える
- `tac`: 行を逆順に並び替える


### 文字置換・文字列演算・正規表現
- `tr`: 単純な文字の置き換えを行う
  + 書式: `tr [置き換え元文字集合] [置き換え先文字集合]`
  + 「第1引数のn番目の文字」を「第2引数のn番目の文字」に置き換える
  + `-c`: 置き換え元文字集合を、指定した文字集合の補集合にする
  + `-s`: 同じ文字が連続している箇所を1文字にまとめる
  + `-d`: 指定した文字集合に含まれる文字を削除する(第2引数は指定しない)

- bashの文字列演算: 変数内の文字列のうち、指定したglobパターンに一致する場所を削除したり置換したりする処理
  + 「文字列」に`null`を指定すれば削除と同じ動作になる

| 書式                       | 処理                                 |
|:-------------------------- |:------------------------------------ |
| `${変数#パターン}`         | 先頭から最短一致した部分を削除       |
| `${変数##パターン}`        | 先頭から最長一致した部分を削除       |
| `${変数%パターン}`         | 末尾から最短一致した部分を削除       |
| `${変数%%パターン}`        | 末尾から最長一致した部分を削除       |
| `${変数/パターン/文字列}`  | 最初の最長一致部分を「文字列」に置換 |
| `${変数//パターン/文字列}` | 全ての最長一致部分を「文字列」に置換 |

- `grep`: 正規表現に一致する行を抽出する
  + デフォルトでは基本正規表現しか使えない(`?`/`+`/`|`/グループ化が利用不可)。拡張正規表現を使うには`-E`オプションを指定する
  + `-v`: 正規表現に一致「しない」行を抽出
  + `-i`: 大文字・小文字を区別しない
  + `-n`: 行番号を表示
  + `-A`/`-B`/`-C`: あとに数値を指定し、それぞれマッチした行の後ろ(After)/前(Before)/前後(マッチした行がCenter)をその行数だけ一緒に表示する  

***

[前へ](c3.md) /
[全体目次へ戻る](index.md) /
[次へ](c5.md)
