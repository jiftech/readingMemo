# リーダブルコード 第15章
[全体目次へ戻る](index.md)

## 15章 ｢分/時間カウンタ｣を設計･実装する
### 15.1 問題点
ウェブサーバの直近1分間と直近1時間の転送バイト数を把握したい。素直な問題だが、効率的に解決するのは簡単ではなさそうだ。まずは、クラスのインタフェースを定義する。

### 15.2 クラスのインタフェースを定義する
以下は、C++で書いたクラスのインタフェースの最初のバージョンだ。

```cpp
class MinuteHourCounter {
  public:
    // カウントを追加する
    void Count(int num_bytes);

    // 直近1分間のカウントを返す
    int MinuteCount();

    // 直近1時間のカウントを返す
    int HourCount();
};
```

クラスを実装する前に、名前とコメントを見ていこう。

#### 名前を改善する
クラス名は明確で具体的で呼びやすい。このクラス名なら、`MinuteCount()`や`HourCount()`というメソッド名も納得がいく。これらのメソッドの名前に`Get`をつけてしまうと、｢軽量アクセサ｣と誤解されてしまうので、使わないほうがいい。

`Count()`というメソッド名には問題がある。このメソッド名だと｢全期間のカウントを返す｣ように聞こえてしまうことがある。代わりになる名前を選ぼう。

- `Increment()`: 値が増加する一方だと思われてしまう
- `Observe()`: 問題ないが、少しあいまい
- `Record()`: 名詞と動詞で違った意味になり、あいまい
- `Add()`: ｢数値を追加する｣｢データのリストに追加する｣の2つの意味があり、両方ともメソッドの動作を表している

仮引数名の`num_bytes`は具体的すぎる。かわりに`delta`のようなもっと汎用的な名前が使えるかもしない。しかし`delta`は値がマイナスになる場面で使うこともあるので、ここでは不適切。`count`なら汎用的で｢マイナスではない｣ことも分かる。

以上の議論から、`Count(int num_bytes)`は`Add(int count)`に変更することにする。

#### コメントを改善する
`Add()`のコメントは冗長なので、削除するか改善すべきだ。

```cpp
// 新しいデータ点を追加する(count >= 0)
// それから1分間は、MinuteCount()の返す値がcountだけ増える
// それから1時間は、HourCount()の返す値がcountだけ増える
void Add(int count);
```

`MinuteCount()`のコメントの｢直近1分間｣は、2通りの解釈ができてしまう。

1. 現在時刻の分数のカウントを返す(例 現在12:13なら、12:13:00〜12:14:00のカウントを返す)
2. ｢直近60秒間のカウント｣を返す

実際の動作は2つめの解釈である。｢直近60秒間｣というより正確で詳細な言葉を使うようにする。(`HourCount()`のコメントも同様に改善する)

これまでの変更を反映したクラス定義は以下のようになる。

```cpp
// 直近1分間および直近1時間の累積カウントを記録する。
// 例えば、帯域幅の使用状況を確認するのに使える。
class MinuteHourCounter {
    // 新しいデータ点を追加する(count >= 0)
    // それから1分間は、MinuteCount()の返す値がcountだけ増える
    // それから1時間は、HourCount()の返す値がcountだけ増える
    void Add(int count);

    // 直近60秒間の累積カウントを返す
    int MinuteCount();

    // 直近3600秒間の累積カウントを返す
    int HourCount();
};
```
***

[前へ](c14.md) /
[全体目次へ戻る](index.md) /
