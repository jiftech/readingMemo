# リーダブルコード 第6章
[全体目次へ戻る](index.md)

## 6章 コメントは正確で簡潔に
鍵となる考え: **コメントは領域に対する情報の比率が高くなければいけない。**

### 6.1 コメントを簡潔にしておく
1行で説明できる内容を、複数の行を使ってまで説明しないようにする。

```cpp
/* 悪い例 */
// intはCategoryType。
// pairの最初のfloatは'score'。
// 2つめは'weight'。
typedef hash_map<int, pair<float, float>> ScoreMap;

/* 良い例 */
// CategoryType -> (score, weight)
// ...
```

### 6.2 あいまいな代名詞を避ける
｢それ｣｢これ｣のような代名詞を具体的な内容に変換するコストを小さくするために、最初から代名詞を避けて具体的な内容を書き残すようにする。

```c
/* ｢その｣は何を指している? */
// データをキャッシュに入れる。ただし、先にそのサイズをチェックする。

/* ｢その｣を具体的な｢データの｣に置き換える */
// データをキャッシュに入れる。ただし、先にデータのサイズをチェックする。

/* 文章全体を書き換えることで代名詞の内容を一意に特定できるようにする */
// データが十分に小さければ、それをキャッシュに入れる。
```

### 6.3 歯切れの悪い文章を磨く
コメントを正確にすることと簡潔にすることは両立することが多い。より単純で直接的な表現を選ぶようにする。

```py
# 歯切れの悪い例
# これまでにクロールしたURLかどうかによって優先度を変える。

# もっと短くて正確な例 上のコメントでは言及されていない情報も含んでいる
# これまでにクロールしていないURLの優先度を高くする。
```

### 6.4 関数の動作を正確に記述する
関数につけるコメントには、関数の処理内容を実装レベルで正確に記す。

例) ファイルの行数を数える関数の｢行数の基準｣(何を数えているのか)を明確にする。
- 改行文字(\n)を数える?
- 改行文字(\n)とキャリッジリターン(\r)を数える?

### 6.5 入出力のコーナーケースに実例を使う
関数の動作を完璧に説明するような実例をコメントに書いておくようにする。

例) 文字列の一部を除去する関数
```cpp
/* 正確でない例(charsは除去する文字列?文字の集合? 複数のcharsがあったら全部除去する?1つだけ?) */
// 'src'の先頭や末尾にある'chars'を除去する。
String Strip(String src, String chars) { ... }

/* 実例を加える(charsは除去する文字の集合で、複数のcharsは全部除去することが分かる) */
// 実例: Strip("abba/a/ba", "ab")は"/a/"を返す
```

例) ベクトルの中身を基準値によって分割する関数
```cpp
/* 正確だが視覚化できていない例 */
// 'v'の｢要素 < pivot｣が｢要素 >= pivot｣の前に来るように配置し直す。
// それから、｢v[i] < pivot｣になる最大のiを返す。なければ-1を返す。
int Partition(vector<int>* v, int pivot);

/* 視覚的な実例を加える */
// 実例: Partition([8 5 9 8 2], 8)の結果は[5 2 | 8 9 8]となり、1を返す。
```

2つ目の例の実例には、コードを理解する上で大切な点が多く盛り込まれている。
- pivotをベクトルの要素と同じにして、エッジケースを示している
- ベクトルに重複要素を入れることで、重複が認められていることを示している
- 結果のベクトルはソートされないことを示している
- 戻り値とベクトルの要素が重複しないようにしている

### 6.6 コードの意図を書く
コードの動作をそのまま書くだけでなく、そのコードが何をしたいのか(意図)をコメントに残すことで、コードが本来の意図と違った動きをすることに気付きやすくなる。

例) 値段の昇順にソートされた商品のリストを逆順にイテレートして表示していく関数→｢値段の高い順に表示する｣
- このとき、実はソート順が値段の降順になっていたとする(バグ)。
  + ｢リストを逆順にイテレートして表示する｣のようなコメントでは、逆順にする意図がわからないのでバグに気づきにくい
  + ｢値段の高い順に表示する｣というコメントがあれば、意図と違う動きであることがすぐに分かる

### 6.7 ｢名前付き引数｣コメント
Pythonのような言語では、引数を名前付きで渡せる。
```py
def Connect(timeout, use_encryption): ...

# 名前付き引数で関数を呼び出す
Connect(timeout = 10, use_encryption = False)
```

C++やJavaには名前付き引数の機能はないが、インラインコメントによって同じような効果を得ることができる。
```java
void Connect(int timeout, boolean useEncryption) { ... }

// 引数にコメントをつけて関数を呼び出す
Connect(/* timeout_ms = */ 10, /* useEncryption = */ false);
```

- 引数名が`timeout_ms`になっている。コメントで名前付き引数を模倣する際には、｢よくない引数名｣を手っ取り早く改善できる。
- 値の前に引数名を置いたほうがよい。

### 6.8 情報密度の高い言葉を使う
頻出の問題に対する解決策を説明する、短くて多くの情報を持つ言葉を使うことで、コメントを簡潔にできる。

```c
/* 長過ぎるコメント */
// このクラスには大量のメンバがある。同じ情報はデータベースにも保管されている。ただし、
// 速度の面からここにも保管しておく。このクラスを読み込むときには、メンバが存在してい
// るかどうかを先に確認する。もし存在していれば、そのまま返す。存在しなければ、データベー
// スから読み込んで、次回のためにデータをフィールドに保管する。


/* 上記の内容を一語で表現する */
// このクラスの役割は、データベースの｢キャッシュ層｣である。
```

多くの意味を含んだ言葉の例: ｢ヒューリスティック｣｢総当たり｣｢ナイーブな解決策｣

***

[前へ](c5.md) /
[全体目次へ戻る](index.md) /
[次へ](c7.md)
