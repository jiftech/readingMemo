# リーダブルコード 第13章
[全体目次へ戻る](index.md)

## 13章 短いコードを書く
自分で書いたコードは、すべての行をテストして保守しなければいけない。ライブラリの再利用や機能の削除をすることで、時間を節約したり、コードを簡潔に維持したりできる。

### 13.1 その機能の実装について悩まないで―――きっと必要ないから
プロジェクトを開始するときには、プロジェクトに欠かせない機能を過剰に見積もってしまう。その結果、多くの機能が完成しない･全く使われないものになってしまう。プログラマは、実装にかかる労力を過小評価しがちである。プロトタイプの実装にかかる時間を楽観的に見積もったり、保守や文書化のために負担する時間を忘れたりする。

### 13.2 質問と要求の分割
すべてのプログラムが、あらゆる入力をうまく処理する必要はない。要求を詳しく調べれば、問題をもっと簡単にできることもある。そうすれば、必要なコードも少なくて済む。

例) 店舗検索システムを作っているとする。要求は以下の通り

- 任意のユーザの緯度経度に対して、最も近い店舗を検索する

これを100%正しく実装するには、以下のことも考慮しなければいけない。

- 日付変更線をまたいでいるときの処理
- 北極や南極に近いときの処理
- 1マイルあたりの経度に対応した地球の曲率の調整

しかし、このアプリケーションで扱うのは、テキサス州にある30軒の店舗だけだ。この小さい範囲で上記の処理を考える必要はない。

例) アプリケーションの速度を改善するために、何かしらのキャッシュを実装したい。LRU方式を使おうとしたが、手持ちのライブラリがなかったので、自分で実装することにした(100行程度のコードが必要)。しかし、アクセスが必ず順番に行われていることに気づいたので、LRU方式ではなく、単項目キャッシュに変更することにした。以下は単項目キャッシュを実装するコード。

```java
DiskObject lasrUsed;

DiskObject lookup(String key) {
    if (lastUsed == null || ! lastUsed.key().equals(key)) {
        lastUsed = loadDiskObject(key);
    }
    return lastUsed;
}
```

コード量は少ないが、LRU方式を使ったときの90%の効果があった。メモリ使用量も少なくなった。

問題の半分を解決するのに、1/4のコーディング時間で済むこともある。

### 13.3 コードを小さく保つ
プロジェクトが進んでいくと、ファイルが増えていき、ディレクトリを分けてファイルを整理する必要が出てくる。どの関数がどの関数を呼び出しているか分からなくなってくる。最終的には、プロジェクトは巨大になって、すべてを把握できる人は誰もいなくなる。新しい機能を追加するのが苦痛になってくる。

あらゆる強調システムは成長する。それらを結びつける複雑さはもっと速い速度で成長する。よって、プロジェクトが成長しても、**コードをできるだけ小さく維持するしかない。** そのためにできることは、以下のようなものだ。

- 汎用的なユーティリティコードを作って、重複を削除する([10章](c10.md)参照)
- 未使用のコードや無用の機能を削除する
- プロジェクトをサブプロジェクトに分割する
- コードの｢重量｣を意識する。軽量で機敏にしておく。

### 13.4 身近なライブラリに親しむ
プログラマは、既存のライブラリで問題を解決できることを知らなかったり、ライブラリで可能なことを忘れていたりすることが多い。たまには標準ライブラリのすべての関数･モジュール。型の名前を15分かけて読んでみよう。ライブラリでどんなことができそうか感じ取るだけでいい。やっておけば、すぐに役立つときが来るはずだ。

例) Pythonのリストから重複を取り除きたいとする。この場合はset型(集合型)を使うのがよい。

```py
# setに変換するだけで重複が消える
unique_elements = set([2,1,2])  # 重複の削除

# リストが必要な場合
unique_elements = list(set([2,1,2]))
```

成熟したライブラリのコードの裏側には、膨大な設計･デバッグ･修正･文書･最適化･テストが存在する。この過程を生き延びてきたコードには大きな価値がある。これが、ライブラリの再利用が良しとされている理由の1つだ。

### 13.6 まとめ
新しいコードを書かないようにするには、

- 不要な機能をプロダクトから削除する。
- 最も簡単に問題を解決するような要求を考える。
- 定期的にすべてのAPIを読んで、標準ライブラリに慣れ親しんでおく。

***

[前へ](c12.md) /
[全体目次へ戻る](index.md) /
[次へ](c14.md)
