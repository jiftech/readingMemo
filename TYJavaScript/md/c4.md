# 独習JavaSctipt 4章
よく使いそうなのだけかいつまんで  
[全体目次へ戻る](index.html)
## 目次
[TOC]

## 4章 ビルトインオブジェクト
### 4.1 ビルトインオブジェクト
組み込みのオブジェクトのこと。

### 4.2 グローバルオブジェクト(Global)
汎用的な機能を提供する。このオブジェクトのプロパティや関数を利用するにはその名前だけを書けばよい。

Globalのプロパティ

|名前|説明|
|:---|:---|
|`infinity` |正の無限大。負の無限大は`-infinity`|
|`NaN`      |非数|
|`undefined`|未定義値|

Globalの関数

|名前|説明|
|:---|:---|
|`encodeURI(str)`|引数の文字列をURLエンコードする。`%xx%xx...`みたいなやつ。URLで意味を持つ文字はエンコードしない|
|`encodeURIComponent(str)`|引数の文字列をURLエンコードする。すべての文字をエンコードする|
|`decodeURI(str)`|URLエンコードされた文字列を元の文字列に変換する。URLで意味を持つ文字はデコードしない|
|`decodeURIComponent(str)`|URLエンコードされた文字列を元の文字列に変換する。すべての文字をデコードする|
|`eval(str)`|引数の文字列をJSコードと解釈し実行する|

### 4.3 論理値・数値を扱うオブジェクト
`Boolean`と`Number`。ある型のオブジェクトを他の型に変換するメソッドが用意されているが、だいたい自動で変換されるのであまり使わない。

Numberのプロパティ(定数)

|名前|説明|
|:---|:---|
|`MAX_VALUE`/`MIN_VALUE`|JSで扱える最大値/最小値|

### 4.4 日付と時刻を扱うオブジェクト
`Date`オブジェクト。Dateオブジェクトを生成する方法は4通り

```js
var d1 = new Date();    // 現在の時刻を表すDateを生成
var d2 = new Date(ms);  // 1970/1/1 0:00 からの経過時間(ミリ秒)によって日時を指定
var d3 = new Date(str); // "2016/1/14 20:00"のような日時を表す文字列で日時を指定
var d4 = new Date(Y, M[, D, h, m, s, ms]) // 年、月、(日、... 、ミリ秒)を引数に指定する。カッコ内は省略可
```

Dateオブジェクトのメソッド

|名前|説明|
|:---|:---|
|`get***()`|日時のある属性(日、分など)を取得。***は属性名。日は`Date`、曜日は`Day`。年は`FullYear`で取得したほうが良い。|
|`getTime()`|1970/1/1 0:00からの経過時間を取得|
|`set***()`|日時のある属性を設定する。|
|`toDateString()`|日時の日付部分を文字列として返す|
|`toTimeString()`|日時の時刻部分を文字列として返す|
|`toString()`|日時を文字列として返す|
|`toLocale["",Date,Time]String()`|日時の[全て,日付部分,時刻部分]を現地の形式の文字列で返す|

Dateオブジェクトの静的メソッド(Date.***()で呼び出す)

|名前|説明|
|:---|:---|
|`now()`|1970/1/1 0:00からの経過時間を取得|
|`parse(str)`|引数の文字列を解析し、その日時の1970/1/1 0:00からの経過時間を取得|

月の数値は**1月→0、2月→1...**となるので注意

### 4.5 配列を扱うオブジェクト
`Array`オブジェクト。配列は`new Array()`という形でも生成できる。引数に複数の値を渡せばその値で初期化される。

```js
// どちらも同じ
var array1 = [1, 2, 3];
var array2 = new Array(1, 2, 3);

// これは要素数10の空の配列になる
var array3 = new Array(10);
```

プロパティ

|名前|説明|
|:---|:---|
|`length`|要素数。設定もできる(!?)|

メソッド

|名前|説明|
|:---|:---|
|`concat(a1, ...)`|この配列に引数の配列を連結|
|`push(e1, ...)`|この配列の**最後**に引数の要素を追加|
|`pop()`|この配列の**最後**から要素を取り出す|
|`unshift(e1, ...)`|この配列の**最初**に引数の要素を追加|
|`shift()`|この配列の**最初**から要素を取り出す|
|`reverse()`|この配列の要素の順番を逆にする|
|`sort([sortFunc])`|(比較関数`sortFunc`による順序に)配列をソート|
|`slice(start[, end])`|指定範囲の要素をコピーする|
|`indexOf(query[, from])`|配列の最初から(`from`番目の要素から後で)`query`を検索し、場所を返す|
|`lastIndexOf(query[, from])`|配列の最後から(`from`番目の要素から前で)`queryを`検索し、場所を返す|
|`toString()`|配列の文字列形式を返す|
|`join([sep])`|配列の要素が引数の文字で区切られた文字列を返す。(引数省略時はコンマ区切り)|
|`every(pred)`|`pred`を配列の全要素に適用した結果、すべての結果が`true`なら`true`を返す|
|`some(pred)`|`pred`を配列の全要素に適用した結果、1つでも結果が`true`となる要素があれば`true`を返す|
|`forEach(func)`|`func`を配列の全要素に適用する|
|`map(func)`|`func`を配列の全要素に適用し、その結果を新たな配列に格納して返す|
|`filter(pred)`|`pred`を配列の全要素に適用し、結果が`true`だった要素を集めた配列を返す|
|`reduce(func[, init])`|まず`func`(2変数関数)を配列の1番目と2番めの要素に適用。次にその結果と3番めの要素に適用。これを順番に繰り返し、最後まで行ったらその結果を返す。もし`init`が指定されていれば、まず`init`と配列の1番目の要素に適用。(以降同様)|
|`reduceRight(func[, init])`|`reduce`の適用する順番が最後からになったバージョン|

文字列の配列を長さ順にソートする例:

```js
var a = ["bb", "aaa", "dddd", "c"];
var sortFunc = function(a, b){
  return a.length - b.length;
}
var res = a.sort(sortFunc); // ["c", "bb", "aaa", "dddd"]
```

`push`と`pop`でスタック。`push`と`shift`でキュー。

### 4.6 文字列を扱うオブジェクト
`String`オブジェクト。

配列と同様、長さを返す`length`プロパティがある。

メソッド

|名前|説明|
|:---|:---|
|`concat(str1, ...)`|この文字列に引数の文字列を連結|
|`charAt(index)`|指定位置の文字を返す|
|`(last)indexOf(searchStr)`|文字列の先頭から順に引数の文字列に一致する場所を探し、その場所を返す。`last~`は文字列の最後から順に探す|
|`search(cond)`|指定した条件に一致する場所を探し、その場所を返す。条件は文字列または正規表現(`RegExp`オブジェクト)|
|`replace(cond, repl)`|条件に一致する場所を`repl`の文字列で置き換える。条件は文字列か正規表現|
|`match(regex)`|指定した正規表現に一致する部分文字列を配列で返す|
|`slice/substring(start[, end])`|指定範囲の部分文字列を返す。`end`を省略すると文字列の最後まで|
|`split(delimiter)`|文字列を引数に指定した区切り文字で分割し、配列で返す|
|`to[Lower/Upper]Case()`|全部の文字を[小文字/大文字]にした文字列を返す。|
|`trim()`|文字列の両端の空白を取り除く|

静的メソッド

|名前|説明|
|:---|:---|
|`fromCharCode(code1, ...)`|引数の文字コードを文字に変換し、並べた文字列を返す|

`indexOf`メソッドは、指定した文字列が見つからなければ-1を返す。

`replace`,`match`に指定する正規表現のオブジェクトを生成するとき、"g"を引数に渡すと、一致したすべての場所を置換する(返す)。

### 4.7 数値計算を扱うオブジェクト
`Math`オブジェクト。コンストラクタがないので、`new Math()`などとするとエラーになる。

プロパティ(定数)

|名前|説明|
|:---|:---|
|`E`    |自然対数の底|
|`PI`   |円周率|
|`SQRT2`|2の平方根|

静的メソッド(数学関数)

|名前|説明|
|:---|:---|
|`abs(x)`|絶対値|
|`sqrt(x)`|平方根|
|`exp(x)`|自然対数の底*e*のx乗|
|`log(x)`|自然対数|
|`pow(x, n)`|xのn乗|
|`[cos/sin/tan](x)`|[コサイン/サイン/タンジェント]|
|`a[cos/sin/tan](x)`|アーク[コサイン/サイン/タンジェント]|
|`atan2(y, x)`|座標(x, y)の偏角|
|`[max/min](x1, ...)`|引数の中で[最大/最小]の値|
|`[floor/ceil/round](x)`|切り捨て/切り上げ/四捨五入|
|`random()`|0.0以上1.0未満の乱数|

### 4.8 正規表現を扱うオブジェクト
`RegExp`オブジェクト。オブジェクトを生成するときに正規表現と「フラグ」を指定する。

```js
var regex = new RegExp("..."[, "g"/"i"/"m"]);
```

フラグは、検索方式を指定するオプション。

+ "g": グローバルフラグ。一致するすべての場所を検索するようになる
+ "i": 大文字小文字の区別をしない
+ "m": 複数行でのマッチング

メソッド

|名前|説明|
|:---|:---|
|`exec(str)`|引数の文字列から、このオブジェクトが表す正規表現に一致する部分を検索し、配列で返す|
|`test(str)`|引数の文字列に、正規表現に一致する場所があれば`true`を返す|

グローバルフラグを指定した`RegExp`の`exec`メソッドは、文字列から正規表現に一致する場所を1つずつ順番に取得する。(対して`String`の`match`メソッドは一気に探して全ての一致箇所を配列にして返す)最後の一致箇所を過ぎると`null`を返す。

検索結果は次のようなオブジェクトになる。

`['一致した文字列', (グループ化された場所に一致した文字列1, ... ,) index: 一致場所, input: 検索対象]`

例:

```js
var s = "foo: 1, bar: 2, hoge: 3";
var r = new RegExp("([a-z]+):\\([0-9])+", "g");
r.exec(s);  // ['foo: 1', 'foo', '1', index: 0, input: 'foo: 1, bar: 2, hoge: 3']
r.exec(s);  // ['bar: 2', 'bar', '2', index: 8, ...]
r.exec(s);  // ['hoge: 3', 'hoge', '3', ...]
r.exec(s);  // null
```

### 4.9 エラーを扱うためのオブジェクト
`Error`オブジェクト、およびエラーの種類に応じた`***Error`オブジェクト。下のようにしてエラーオブジェクトを生成できる。引数のメッセージを省略すると、各エラーのデフォルト値が使われる。

`var e = new Error([msg]);`

### 4.10 関数/オブジェクトを扱うオブジェクト
関数は`Function`オブジェクト、オブジェクトは`Object`オブジェクト。詳しくは5/6章で。

新しく、JSON形式の文字列をオブジェクトに変換するための`JSON`オブジェクトが追加された。`parse(text)`で引数の文字列をオブジェクトに、`stringify(obj)`で引数のオブジェクトをJSON形式の文字列に変換できる。

***

[前へ](c123.html) / [全体目次へ戻る](index.html) / [次へ](c56.html)