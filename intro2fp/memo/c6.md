# 関数プログラミング入門 Haskellで学ぶ原理と技法 第6章
[全体目次へ戻る](../index.md)

## 6章 木
- 非線形の構造を表す再帰的データ型。分岐構造や情報を乗せる位置などによって様々な種類に分類される

### 二分木
- 分岐において2方向に分岐する木

```haskell
-- Leaf: 1つのデータを持つ葉
-- Fork: 2つの部分木を持つ分岐
data Btree a = Leaf a | Fork (Btree a) (Btree) a
```

- 木の帰納法
  + `_|_`の場合: `P(_|_)`が成り立つ
  + `Leaf x`の場合: `P(Leaf x)`が成り立つ
  + `Fork(xt yt)`の場合: `P(xt)`と`P(yt)`が成り立つことを仮定すれば`P(Fork xt yt))`も成り立つ

- 木の基本的な操作

```haskell
-- 木に含まれる葉の数
size :: Btree a -> Int
size (Leaf x) = 1
size (Fork xt yt) = size xt + size yt

-- 木をリストに変換
flatten :: Btree a -> [a]
flatten (Leaf x) = [x]
flatten (Fork xt yt) = flatten xt ++ flatten yt

-- 内部節点(葉でない節点)の数
-- 定理: size xt = 1 + nodes xt
nodes :: Btree a -> Int
nodes (Leaf x) = 0
nodes (Fork xt yt) = 1 + nodes xt + nodes yt

-- 木の高さ (深さ(根から葉までの距離)の最大値)
height :: Btree a -> Int
height = maxBtree . depths

-- 部分木に含まれる最大要素を返す
maxBtree :: (Ord a) => Btree a -> a
maxBtree (Leaf x) = x
maxBtree (Fork xt yt) = (maxBtree xt) `max` (maxBtree yt)

-- 木の全ての葉の値を、その葉の深さに置き換える
depths :: Btree a -> Btree Int
depths = down 0

-- depthsの内部処理
down :: Int -> Btree a -> Btree Int
down n (Leaf x) = Leaf n
down n (Fork xt yt) = Fork (down (n + 1) xt) (down (n + 1) yt)
```

- 全ての葉の深さが等しい木を「完全な木」という
- 二分木の性質: `height xt < size xt <= 2 ^ height xt`


- 写像と畳み込み

```haskell
-- 木の各要素に関数fを適用
-- リストのmapと同様の法則を満たす
mapBtree :: (a -> b) -> Btree a -> Btree b
mapBtree f (Leaf x) = Leaf (f x)
mapBtree f (Fork xt yt) = Fork (mapBtree f xt) (mapBtree f yt)

-- 木の畳み込み 二分木は以下の構造を持つので、それぞれを置き換える関数を提供する必要がある
-- Leaf :: a -> Btree a
-- Fork :: Btree a -> Btree a -> Btree a
foldBtree :: (a -> b) -> (b -> b -> b) -> Btree a -> b
foldBtree f g (Leaf x) = f x
foldBtree f g (Fork xt yt) = g (foldBtree f g xt) (foldBtree f g yt)

-- 二分木上の多くの演算はfoldBtreeを使って定義できる
-- ただし、constは定数関数(2つ引数を取るが、常に第1引数を返す)
-- const :: a -> b -> a
-- const x y = x
size = foldBtree (const 1) (+)
height = foldBtree (const 0) (<+>)
         where m <+> n = 1 + (m `max` n)
flatten = foldBtree wrap (++)
         where wrap x = [x]
maxBtree = foldBtree id (`max`)
mapBtree f = foldBtree (Leaf . f) Fork
```

- 拡張二分木: 内部節点にも情報を載せることができる二分木
```haskell
-- 「大きさ」という付加情報を持つ二分木
data Atree a = Leaf a | Fork Int (Atree a) (Atree a)

-- スマートコンストラクタ
fork :: Atree a -> Atree a -> Atree a
fork xt yt = Fork (lsize xt) xt yt

lsize :: Atree a -> Int
lsize (Leaf x) = 1
lsize (Fork n xt yt) = n + lsize yt
```

***

[前へ](c5.md) /
[全体目次へ戻る](../index.md) /
[次へ](c7.md)
